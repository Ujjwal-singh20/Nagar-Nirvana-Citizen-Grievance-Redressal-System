{% extends 'dashboard/base_dashboard.html' %}

{% block dashboard_title %}Authority Dashboard{% endblock %}

{% block sidebar %}
<div class="card border-0 shadow-sm mt-4">
    <div class="card-body">
        <h6 class="text-uppercase text-muted mb-3 mt-4">Authority Panel</h6>
        <div class="nav flex-column gap-2 mt-4">
            <a class="btn btn-outline-primary text-start" href="{% url 'dashboard:authority_dashboard' %}">
                <i class="fa-solid fa-chart-line me-2"></i> Overview
            </a>
            <a class="btn btn-outline-secondary text-start" href="{% url 'dashboard:analytics' %}">
                <i class="fa-solid fa-chart-pie me-2"></i> Analytics
            </a>
            <a class="btn btn-outline-danger text-start" href="{% url 'accounts:logout' %}">
                <i class="fa-solid fa-right-from-bracket me-2"></i> Logout
            </a>
        </div>
    </div>
</div>
{% endblock %}

{% block dashboard_content %}
<div class="d-flex flex-column flex-lg-row justify-content-between align-items-start align-items-lg-center gap-2 mb-4 mt-2">
    <div>
        <div class="section-title">
            <i class="fa-solid fa-shield-halved text-primary"></i>
            <span>Authority Dashboard</span>
        </div>
        <p class="text-muted mb-0">Monitor complaint flow and update statuses efficiently.</p>
    </div>
    <div class="d-flex flex-wrap gap-2 mt-4">
        <a href="{% url 'complaints:complaint_list' %}" class="btn btn-outline-primary">
            <i class="fa-solid fa-list-check me-1"></i> All Complaints
        </a>
        <a href="{% url 'dashboard:analytics' %}" class="btn btn-outline-secondary">
            <i class="fa-solid fa-chart-pie me-1"></i> Analytics
        </a>
        <a href="{% url 'complaints:complaint_map' %}" class="btn btn-outline-secondary">
            <i class="fa-solid fa-map-location-dot me-1"></i> Map View
        </a>
    </div>
</div>

<div class="row g-4 mb-4 mt-2">
    <div class="col-md-4">
        <div class="card shadow-sm border-0 text-center">
            <div class="card-body">
                <i class="fa-solid fa-list fa-2x text-primary mb-2"></i>
                <h6 class="text-muted">Total Complaints</h6>
                <h3 class="fw-bold">{{ total }}</h3>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card shadow-sm border-0 text-center">
            <div class="card-body">
                <i class="fa-solid fa-spinner fa-2x text-warning mb-2"></i>
                <h6 class="text-muted">Submitted</h6>
                <h3 class="fw-bold">{{ pending }}</h3>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card shadow-sm border-0 text-center">
            <div class="card-body">
                <i class="fa-solid fa-circle-check fa-2x text-success mb-2"></i>
                <h6 class="text-muted">Resolved</h6>
                <h3 class="fw-bold">{{ resolved }}</h3>
            </div>
        </div>
    </div>
</div>

<div class="row g-4 mb-4">
    <div class="col-md-6">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-body">
                <h5 class="fw-semibold mb-2"><i class="fa-solid fa-bolt text-primary me-2"></i>Priority Actions</h5>
                <p class="text-muted mb-3">Take quick actions for high-impact tasks.</p>
                <div class="d-grid gap-2">
                    <a class="btn btn-outline-primary" href="{% url 'complaints:complaint_map' %}">
                        Open Map & Assign
                    </a>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-body">
                <h5 class="fw-semibold mb-2"><i class="fa-solid fa-circle-info text-primary me-2"></i>Status Tips</h5>
                <ul class="text-muted mb-0">
                    <li>Mark "In Progress" once assigned to a team.</li>
                    <li>Add a brief comment with each update.</li>
                    <li>Close only after verification or citizen feedback.</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<div class="card shadow-sm border-0 mt-4 mb-4">
    <div class="card-header bg-white fw-semibold d-flex justify-content-between align-items-center">
        <span>Recent Complaints (Authority View)</span>
        <span class="text-muted small">Update status from the list</span>
    </div>
    <div class="p-3">
        <div class="table-responsive">
            <table class="table align-middle mb-0">
                <thead class="table-light">
                    <tr>
                        <th>ID</th>
                        <th>Title</th>
                        <th>Status</th>
                    <th>Submitted</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for c in recent_complaints %}
                <tr>
                    <td>#NN-{{ c.id }}</td>
                    <td>{{ c.title }}</td>
                    <td>
                        <span class="badge
                        {% if c.status == 'Submitted' %}badge-pending
                        {% elif c.status == 'In Progress' %}badge-progress
                        {% else %}badge-resolved{% endif %}
                        px-3 py-2 rounded-pill">
                        {{ c.status }}
                        </span>
                    </td>
                    <td>{{ c.created_at|date:"M d, Y" }}</td>
                    <td>
                        <a href="{% url 'complaints:complaint_detail' c.id %}" class="btn btn-sm btn-outline-primary">
                            Update Status
                        </a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" class="text-center text-muted py-4">No complaints yet.</td>
                </tr>
                {% endfor %}
            </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
